#!/bin/bash

function uosfindbase {
	curr=`pwd`
	file_name=global/uos.php
	#echo "Current directory: $curr"
	while [ "$curr" != "/" ]; do
		#echo "Processing: $curr"
		file="$curr/$file_name"
		if [ -f "$file" ]; then
			echo $curr
			#cd "$curr"
			#"$@"
			exit
		fi
		curr="`dirname \"$curr\"`"
	done
	echo 0
}

uosbasedir=$(uosfindbase)

if [ $uosbasedir == 0 ]; then
	echo "Universe not found"
	exit 0
fi

#echo $uosbasedir
cd $uosbasedir/global/
uosbasephp=$uosbasedir/global/uos.php
#echo $uosbasephp
#echo "'$1'"
#url=$(printf '%q' $1)
#url="/one/two?dgdfgdfg"
sessionid='2e56bc6c16f8dff1f29fb163d33c8d5a'
docroot=$(printf '%q' $uosbasedir)

#request=$(printf '{"url":"%s","documentroot":"%s","sessionid":"%s"}' "$url" "$uosbasedir" "$session")
request=$(printf '{"url":"%b","documentroot":"%s","sessionid":"%s"}' "$1" "$uosbasedir" "$sessionid")


case "$1" in

'install')  
    echo "Install UniverseOS $1"
    ;;

*) 
   result=$(php -f $uosbasephp -- $request)
   echo $result
   ;;

esac
