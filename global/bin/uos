#!/bin/bash

function uosfindbase {
	curr=`pwd`
	file_name=global/uos.php
	#echo "Current directory: $curr"
	while [ "$curr" != "/" ]; do
		#echo "Processing: $curr"
		file="$curr/$file_name"
		if [ -f "$file" ]; then
			echo $curr
			#cd "$curr"
			#"$@"
			exit
		fi
		curr="`dirname \"$curr\"`"
	done
	echo 0
}

uosbasedir=$(uosfindbase)
#echo $uosbasedir
cd $uosbasedir/global/
uosbasephp=$uosbasedir/global/uos.php
#echo $uosbasephp
url=$(printf '%q' $1)
session=123456789
docroot=$(printf '%q' $uosbasedir)

request=$(printf '{"url":"%s","documentroot":"%s","sessionid":"%s"}' "$url" "$uosbasedir" "$session")


case "$1" in

'install')  
    echo "Install UniverseOS $1"
    ;;

*) 
   result=$(php -f $uosbasephp -- $request)
   echo $result
   ;;

esac
